<!doctype html>
<html lang="da">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>DRHX – Table 3 (Input Status Bits)</title>
<style>
  body{font:15px system-ui,Segoe UI,Arial;margin:0;background:#fafafa}
  .wrap{max-width:760px;margin:24px auto;padding:16px;background:#fff;border:1px solid #eee;border-radius:10px}
  h1{font-size:18px;margin:0 0 10px}
  p{color:#666;font-size:13px;margin:0 0 12px}
  table{border-collapse:collapse;width:100%}
  th,td{border:1px solid #e5e5e5;padding:6px 8px}
  th{background:#f6f6f6;text-align:left}
  td.state{white-space:nowrap}
  .banner{padding:10px 12px;border-radius:8px;margin:0 0 12px;font-weight:600;border:1px solid transparent}
  .ok{background:#e8f5e9;color:#1b5e20;border-color:#c8e6c9}
  .warn{background:#fff8e1;color:#795548;border-color:#ffe082}
  .crit{background:#ffebee;color:#b71c1c;border-color:#ffcdd2}
  .sub{margin:-6px 0 12px;color:#555;font-size:12px}
  code{background:#f3f3f3;padding:1px 4px;border-radius:4px}
</style>
<div class="wrap">
  <div id="faultBanner" class="banner ok">Fejlkode: Ingen (OK)</div>
  <p id="faultSub" class="sub" hidden></p>

  <h1>Table 3 — Input Status Bits</h1>
  <p>URL-format: <code>?0001=1&0002=0&0011=1...</code></p>
  <table id="tbl">
    <thead><tr><th>Register</th><th>Name</th><th>State</th></tr></thead>
    <tbody></tbody>
  </table>
</div>
<script>
const rows = [
 {reg:'0001', name:'Rotorguard Alarm', active:'Alarm'},
 {reg:'0002', name:'V LO Alarm', active:'Alarm'},
 {reg:'0003', name:'V HI Alarm', active:'Alarm'},
 {reg:'0004', name:'I HI Alarm (Motor out short)', active:'Alarm'},
 {reg:'0005', name:'Temperature High', active:'Warning'},
 {reg:'0009', name:'Rotorguard Signal', active:'Pulse'},
 {reg:'0010', name:'Overload / I Limit', active:'Warning'},
 {reg:'0011', name:'Internal Stop', active:'Alarm (Stop)'},
 {reg:'0012', name:'Rotor Blocked', active:'Alarm'},
 {reg:'0013', name:'EEPROM Error', active:'Warning'},
 {reg:'0014', name:'Comm. Error MOC', active:'Alarm'},
 {reg:'0015', name:'Motor Phase Error', active:'Alarm'},
 {reg:'0016', name:'Ripple', active:'Warning'},
 {reg:'0017', name:'Digital Input 1', active:'HI'},
 {reg:'0018', name:'Digital Input 2', active:'HI'},
 {reg:'0019', name:'External 24 V Overload', active:'Overload'},
 {reg:'0020', name:'MOC Bootloader Active', active:'Alarm'},
 {reg:'0021', name:'Digital Input 3', active:'HI'},
 {reg:'0022', name:'Digital Input 4', active:'HI'},
 {reg:'0023', name:'Comm. Error IOM', active:'Warning'},
 {reg:'0024', name:'Rotation OK', active:'OK'},
 {reg:'0025', name:'Test Active', active:'Active'},
 {reg:'0026', name:'Purge Active', active:'Active'},
 {reg:'0027', name:'IO Config Mismatch', active:'Warning'},
];

// Valgfrie fejlkoder (viser '—' hvis ukendt)
const codeMap = {
 '0001':'E01',
 '0003':'E02',
 '0002':'E03',
 '0004':'E04',
 '0005':'E05',
 '0012':'E06',
 '0015':'E08'
};

const params = new URLSearchParams(location.search);
const tb = document.querySelector('#tbl tbody');
const bit = r => params.get(r) === '1';

// Udfyld tabellen
rows.forEach(r=>{
  const v = params.get(r.reg);
  const state = (v === '1') ? r.active : '0';
  const tr = document.createElement('tr');
  tr.innerHTML = `<td>1x${r.reg}</td><td>${r.name}</td><td class="state">${state}</td>`;
  tb.appendChild(tr);
});

// Alle aktive fejl (Alarm/Warning)
const activeErrors = rows.filter(r => bit(r.reg) && /Alarm|Warning/.test(r.active));
const hasCrit = activeErrors.some(r => /Alarm/.test(r.active)); // "Alarm (Stop)" = kritisk
const banner = document.getElementById('faultBanner');

if (activeErrors.length === 0){
  banner.className = 'banner ok';
  banner.textContent = 'Fejlkode: Ingen (OK)';
} else {
  banner.className = 'banner ' + (hasCrit ? 'crit' : 'warn');
  const list = activeErrors.map(r => `${codeMap[r.reg] || '—'} ${r.name} (1x${r.reg})`);
  banner.textContent = 'Fejl: ' + list.join(' · ');
}

// Ekstra indikatorer (vises som note)
function indicators(){
  const list = [];
  if (bit('0011')) list.push('1x0011 Internal Stop');
  if (bit('0014')) list.push('1x0014 Comm. Error MOC');
  if (bit('0023')) list.push('1x0023 Comm. Error IOM');
  if (bit('0009')) list.push('1x0009 Rotorguard Signal');
  if (bit('0024')) list.push('1x0024 Rotation OK');
  return list;
}
const sub = document.getElementById('faultSub');
const hints = indicators();
if (hints.length){
  sub.hidden = false;
  sub.textContent = 'Aktive indikatorer: ' + hints.join(' · ');
}
</script>
</html>
